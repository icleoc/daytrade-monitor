<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>VWAP Monitor</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { background: #111; color: #eee; font-family: Arial; text-align: center; }
        .chart { width: 95%; margin: 20px auto; }
        .error { color: #f55; }
    </style>
</head>
<body>
    <h1>ðŸ“Š VWAP Monitor</h1>
    <div id="charts"></div>

    <script>
        const symbols = {{ symbols | tojson }};
        const updateInterval = {{ update_interval }};

        async function updateCharts() {
            const res = await fetch('/api/data');
            const data = await res.json();
            const charts = document.getElementById('charts');
            charts.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'chart';
                if (item.error) {
                    div.innerHTML = `<h3>${item.symbol}</h3><p class="error">${item.error}</p>`;
                } else {
                    const tracePrice = {
                        x: item.df.map(x => x.datetime),
                        y: item.df.map(x => x.close),
                        mode: 'lines',
                        name: 'PreÃ§o'
                    };
                    const traceVWAP = {
                        x: item.df.map(x => x.datetime),
                        y: item.df.map(x => x.vwap),
                        mode: 'lines',
                        name: 'VWAP'
                    };
                    Plotly.newPlot(div, [tracePrice, traceVWAP], { title: item.symbol, template: 'plotly_dark' });
                }
                charts.appendChild(div);
            });
        }

        updateCharts();
        setInterval(updateCharts, updateInterval * 1000);
    </script>
</body>
</html>
