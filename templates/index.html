<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content="30">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Painel VWAP - Sinais</title>
  <style>
    body { background:#071028; color:#e6eef6; font-family: Inter, system-ui, sans-serif; padding:20px; }
    h1 { color:#7dd3fc; text-align:center; margin-bottom:12px; }
    .grid { display:grid; gap:18px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); max-width:1100px; margin:0 auto; }
    .card { border-radius:12px; padding:18px; box-shadow: 0 8px 30px rgba(2,6,23,0.7); text-align:center; }
    .card h2 { margin:0 0 8px 0; font-size:18px; }
    .msg { font-weight:700; font-size:16px; margin-bottom:8px; }
    .meta { font-size:13px; color:#cbd5e1; }
    .buy { background: linear-gradient(135deg,#16a34a,#65e8a6); color:#02140a; }
    .sell { background: linear-gradient(135deg,#ef4444,#ff8a8a); color:#2b0b0b; }
    .neutral { background: linear-gradient(135deg,#475569,#94a3b8); color:#f8fafc; }
    .small { font-size:12px; opacity:0.95; }
  </style>
</head>
<body>
  <h1>ðŸ“Š VWAP Signals â€” AtualizaÃ§Ã£o a cada 30s</h1>
  <div class="grid">
    {% for s in sinais %}
      {% set cls = 'neutral' %}
      {% if s['sinal'] == 'COMPRA' %}{% set cls = 'buy' %}{% endif %}
      {% if s['sinal'] == 'VENDA' %}{% set cls = 'sell' %}{% endif %}
      <div class="card {{ cls }}">
        <h2>{{ s['ativo'] }} <span class="small">({{ s['fonte'] }})</span></h2>
        <div class="msg">
          {% if s['sinal'] == 'COMPRA' %}
            ðŸŸ¢ COMPRAR AGORA
          {% elif s['sinal'] == 'VENDA' %}
            ðŸ”´ VENDER AGORA
          {% else %}
            âšª AGUARDAR
          {% endif %}
        </div>
        <div class="meta">
          PreÃ§o: <strong>{{ "%.6f"|format(s['preco']|float) }}</strong><br/>
          VWAP: <strong>{{ "%.6f"|format(s['vwap']|float) }}</strong><br/>
          ConfianÃ§a: <strong>{{ s['probabilidade'] }}%</strong><br/>
          HorÃ¡rio (local): <span class="hora-local" data-utc="{{ s['timestamp'] }}"></span>
        </div>
      </div>
    {% endfor %}
  </div>

  <script>
    document.querySelectorAll('.hora-local').forEach(el=>{
      const utc = el.dataset.utc;
      if (!utc) { el.textContent = ''; return; }
      const d = new Date(utc);
      el.textContent = d.toLocaleString([], { hour: '2-digit', minute:'2-digit', second:'2-digit', day:'2-digit', month:'2-digit', year:'numeric' });
    });
  </script>
</body>
</html>
